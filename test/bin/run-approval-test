#!/usr/bin/env bash

set -euo pipefail

PROJECT_DIR=$(cd "$(dirname "$0")"/../..; pwd)
TEST=$1
TEST_DIR="$(dirname "$TEST")"
RELATIVE_PATH=$(realpath "$TEST_DIR" --relative-to "$PROJECT_DIR")

echo testing "$RELATIVE_PATH" ...

if ! "${TEST}" "${PROJECT_DIR}" |& diff "${TEST_DIR}/expected.txt" -
then
  printf "\033[0;31mFAILED\033[0m %s\n" "$RELATIVE_PATH"
  exit 1
fi

printf "\033[0;32mPASSED\033[0m\n"
